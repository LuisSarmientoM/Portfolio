---
import '../styles/tailwind.css';

interface Props {
  lang?: string;
  description?: string;
  languages?: Array<{ code: string; label: string }>;
  currentLanguage?: string;
  defaultLanguage?: string;
  name?: string;
}

const {
  lang = 'en',
  description = 'Résumé and portfolio for Bartosz Jarocki',
  languages = [],
  currentLanguage,
  defaultLanguage,
  name,
}: Props = Astro.props;

const baseUrl = import.meta.env.BASE_URL;
const normalizedBaseUrl = baseUrl.endsWith('/') ? baseUrl : `${baseUrl}/`;
const basePath = normalizedBaseUrl.endsWith('/') ? normalizedBaseUrl.slice(0, -1) : normalizedBaseUrl;
const currentPath = Astro.url.pathname;
const pathWithoutBase = currentPath.startsWith(basePath)
  ? currentPath.slice(basePath.length)
  : currentPath;
const currentLanguagePrefix =
  currentLanguage && defaultLanguage && currentLanguage !== defaultLanguage ? `/${currentLanguage}` : '';
const pathWithoutLanguage = currentLanguagePrefix && pathWithoutBase.startsWith(currentLanguagePrefix)
  ? pathWithoutBase.slice(currentLanguagePrefix.length)
  : pathWithoutBase;
const pathSuffix = pathWithoutLanguage === '' ? '/' : pathWithoutLanguage;
const isBlogRoute = pathSuffix.startsWith('/blog');
const homeHref = `${basePath}${currentLanguagePrefix}/`;
const blogHref = `${basePath}/blog/`;
const showLanguageSelector = languages.length > 0 && currentLanguage && defaultLanguage;
const getLanguageHref = (code: string) => {
  if (isBlogRoute) {
    return `${basePath}${pathSuffix}`;
  }
  const languagePrefix = defaultLanguage && code === defaultLanguage ? '' : `/${code}`;
  return `${basePath}${languagePrefix}${pathSuffix}`;
};
---
<!DOCTYPE html>
<html lang={lang} class="scroll-smooth bg-slate-950 text-slate-100">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <slot name="head" />
  </head>
  <body class="min-h-screen bg-[radial-gradient(circle_at_20%_20%,rgba(79,70,229,0.18),transparent_30%),radial-gradient(circle_at_80%_0%,rgba(16,185,129,0.16),transparent_32%),radial-gradient(circle_at_0%_60%,rgba(14,165,233,0.12),transparent_35%)]">
    <header class="fixed left-0 right-0 top-0 z-50">
      <div class="mx-auto max-w-6xl px-6">
        <div class="grid grid-cols-[1fr_auto_1fr] items-center gap-4 py-3">
          <div class="flex items-center text-left">
            {name && <span class="text-sm font-semibold uppercase tracking-[0.2em] text-slate-300">{name}</span>}
          </div>
          <nav class="inline-flex items-center justify-center gap-2 rounded-full bg-slate-950/70 px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-slate-200 ring-1 ring-inset ring-slate-800 backdrop-blur">
            <a class="transition hover:text-white" href={homeHref}>Home</a>
            <span class="text-slate-500">/</span>
            <a class="transition hover:text-white" href={blogHref}>Blog</a>
          </nav>
          <div class="flex justify-end text-right">
            {showLanguageSelector && (
              <div class="inline-flex gap-1 rounded-full bg-slate-950/70 p-1 ring-1 ring-inset ring-slate-800 backdrop-blur">
                {languages.map((language) => (
                  <a
                    class={`rounded-full px-3 py-1 text-xs font-semibold transition ${
                      language.code === currentLanguage
                        ? 'bg-indigo-500/20 text-indigo-100 ring-1 ring-inset ring-indigo-500/60'
                        : 'text-slate-300 hover:bg-slate-800 hover:text-white'
                    }`}
                    href={getLanguageHref(language.code)}
                  >
                    {language.code}
                  </a>
                ))}
              </div>
            )}
          </div>
        </div>
      </div>
    </header>
    <main class="mx-auto max-w-6xl px-6 pb-10 pt-24 sm:pb-14 sm:pt-28 lg:pb-16">
      <slot />
    </main>
  </body>
</html>
